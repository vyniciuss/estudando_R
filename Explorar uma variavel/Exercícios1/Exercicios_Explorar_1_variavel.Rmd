---
title: "Análise de Diamantes"
output:
  html_document:
    df_print: paged
---

Este é o exercício para revisão das de algumas técnicas para explorar 1 variável.

```{r}
# carrega o pacote ggplot 
library(ggplot2)
# carrega o conjunto de dados de diamantes, ele vem junto com o pacote ggplot 
data(diamonds)
# visualiza as informações básicas sobre o dataset estudado
?diamonds
# visualizar o nome das variáveis do dataset
names(diamonds)
# visualiza uma tabela com os valores da coluna selecionada
table(diamonds$cut)

```

Podemos perceber no histograma que a distribuição possui uma inclinação positiva.
```{r}
ggplot(aes(x = price), data = diamonds) + 
  geom_histogram()
```
Estatísticas básicas dos diamantes
```{r}
summary(diamonds$price)
```

Contagem de diamantes
```{r}
#Quantidade de diamantes com preço menor que $500
sum(diamonds$price < 500)

#Quantidade de diamantes com preço menor que $500
sum(diamonds$price < 250)

#Quantidade de diamantes com preço maior ou igual a $15.000
sum(diamonds$price >= 15000)

```



Vamos analisar maior pico encontrado na visualização anterior, para isso,  iremos limitar o x-axis:
```{r}
qplot(x = price, data = diamonds) +
  scale_x_continuous(limits = c(0, 2000), breaks = seq(0, 2000, 150))

#1º Não existem diamantes com preço de $1500
#2º Percebe-se que para os diamantes que custam menos que $2000, o preço mais comum é em torno de $700
```


```{r}
qplot(x = price, data = diamonds, binwidth = 1) +
  scale_x_continuous(limits = c(0, 2000), breaks = seq(0, 2000, 100))



```


Distribuição dos diamantes por corte
```{r}
qplot(x = price, data = diamonds) + 
  facet_wrap(~cut)

```

A visualização abaixo demonstra estatísticas básicas sobre cutXpreço.
Responde algumas perguntas como:
  - Qual corte tem o menor/maior preço?
  - Qual corte tem o menor/maior preço médio?
```{r}

 by(diamonds$price,diamonds$cut,summary)
```


No último gráfico, analisamos as estatísticas de resumo para preço de diamante por corte. Se olharmos para a tabela de saída acima, a mediana e os quartis são razoavelmente próximos uns dos outros.
Isso significa que as distribuições devem ser um pouco semelhantes, mas os histogramas que criamos não mostram isso.


Os diamantes "Fair" e "Good" parecem ter diferentes distribuições em relação ao melhor
corte de diamantes. Parecem um pouco uniformes à esquerda com uma cauda longa a direita.

Normalmente as escalas dos eixos em cada gráficos são fixas, isso está dificultando a visualização dos cortes com menos dados. Para isso, será definido scales ="free" para deixas as scalas independentes.
```{r}
qplot( x = price, data = diamonds) +
facet_wrap(~cut, scales = "free")
```


Criamos um histograma de preço por quilate e facetamos por corte.
Foi realizado ajustes para deixar as escalas livres e para aumentar a largura do compartimento com scale_x_log10()
```{r}
qplot(x = price/carat, data = subset(diamonds, !is.na(cut)), 
      binwidth = 0.05, color = I('black'), fill = I('#FFA500'),
      xlab = "Preço por quilate", 
      ylab = "Quantidade de registros") +
      facet_wrap(~cut, scales = "free") +
      scale_x_log10()
```

Boxplot de corte por preço
```{r}
qplot(x = cut, y = price,
      data = diamonds,
      geom = 'boxplot') + 
      coord_cartesian(ylim = c(0, 7500))
```

```{r}
by(diamonds$price,diamonds$cut,summary)
```


Com o a visualização abaixo, temos a impressão que o diamante com clareza de menor qualidade(I1), está dando melhores retornos que o diamante de melhor qualidade(IF).
```{r}

qplot(x = clarity, y = price, data = diamonds,
      geom = 'boxplot') +
      coord_cartesian(ylim = c(0, 7000))
```

Para investigar mais afundo as descobertas da visualização anterior, criei dois dataframes com com dados da pior e melhor clareza.
```{r}

low <- subset(diamonds, clarity == 'I1')

high <- subset(diamonds, clarity == 'IF')


```


Visualizando os dados do preço por quilate do diamante de menor clareza.
```{r}

qplot(x = carat, y = price/carat, data = low) +
  scale_x_continuous(lim=c(0,7.5)) +
  scale_y_continuous(lim=c(0,7000)) +
  labs(title = "Diamantes de baixa clareza")
```

Visualizando os dados do preço por quilate do diamante de maior clareza, percebemos que as pedras dos diamantes de maior clareza são bem menores e a faixa de preço é bem maior. 
```{r}
qplot(x = carat, y = price/carat, data = high) +
  scale_x_continuous(lim=c(0, 2)) +
  scale_y_continuous(lim=c(0,7000)) +
  labs(title = "Diamantes de alta clareza")
```



```{r}
by(diamonds$price, diamonds$clarity, summary)

```

Definindo os subconjuntos das cores D e J
```{r}
diamD <- subset(diamonds, color == 'D')
diamJ <- subset(diamonds, color == 'J')

```
Estatísticas de preço dos diamantes de cor "D"
```{r}
summary(diamD$price)
```



Estatísticas de preço dos diamantes de cor "J"
```{r}
summary(diamJ$price)
```

Descobrindo o intervalo interquartil IQR das cores D
```{r}

IQR(diamD$price)
```
Descobrindo o intervalo interquartil IQR das cores J
```{r}

IQR(diamJ$price)
```

```{r}

qplot(x = color, y = price/carat, data = diamonds,
      geom = 'boxplot', fill = color) +
      coord_cartesian(ylim = c(1500, 6000)) +
      scale_y_continuous(breaks = seq(0, 6000, 500))
  

```

```{r}


qplot(x = carat, y = price/carat, data = diamJ) +
  scale_x_continuous(lim=c(0,7.5)) +
  scale_y_continuous(lim=c(0,7000)) +
  labs(title = "Diamantes de cor ruim")


```

Visualizando os diamantes de melhor cor
```{r}

qplot(x = carat, y = price/carat, data = diamD) +
  scale_x_continuous(lim=c(0,3.5)) +
  scale_y_continuous(lim=c(0,20000)) +
  labs(title = "Diamantes de cor Boa")


```


Obtendo os quilates que possui quantidade maior que 2 mil
```{r}
qplot(x = diamonds$carat,
      data = diamonds,
      binwidth = 0.1,
      xlab = 'Carats',
      ylab = 'Count',
      geom = 'freqpoly') +
  scale_x_continuous(limits = c(0, 2), breaks = seq(0,2,0.1)) +
  scale_y_continuous(breaks = seq(0,12000,1000)) +
  geom_hline(yintercept = 2000)


```

